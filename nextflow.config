manifest {
    mainScript = 'analysis.nf'
}

// default parameters
params {
    cores = "1"
    memory = '12'
    help = false
    profile = false

    // inputs
    fasta = ''
    fastq = ''
    fastqPair = ''
    dir = ''
    dev = ''
    list = false
    
    // databases
    centrifuge_db = false
    gtdbtk_db = false
    sour_db = false
    tax_db = false

    // options
    abricate = false
    centrifuge = false
    deepHumanPathogen = false
    gtdbtk = false
    guppygpu = false
    metamaps = false
    nanoplot = false
    plasflow = false
    sourclass = false
    sourcluster = false
    sourmeta = false
    abricateBatch = false
    
    // basecalling
    flowcell = 'FLO-MIN106'
    kit = 'SQK-LSK109'
    barcode = ''

    // folder structure
    output = 'results'
}

profiles {
    standard {
        params.cloudProcess = false
        workDir = "/tmp/nextflow-work-$USER"
        process.executor = 'local'
        docker { enabled = true }
        process {
            withLabel: abricate { cpus = 1 ; container = 'nanozoo/abricate:0.9.3--db720c5' }  
            withLabel: bwa { cpus = params.cores ; container = 'quay.io/biocontainers/shovill:1.0.4--0'  }
            withLabel: centrifuge { cpus = params.cores ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: centrifugescale { container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: emboss { cpus = params.cores ; container = 'quay.io/biocontainers/emboss:6.5.7--4' }
            withLabel: filtlong { cpus = 1 ; container = 'nanozoo/filtlong:v0.2.0--afa175e' }
            withLabel: ggplot2 { cpus = 1 ; container = 'michelsteuwer/ggplot2:latest' }
            withLabel: gtdbtk { cpus = params.cores ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' }     
            withLabel: krona { cpus = params.cores ; container = 'nanozoo/krona:2.7.1--658845d' }
            withLabel: metamaps { cpus = params.cores ; container = 'nanozoo/metamaps:latest' }
            withLabel: nanoplot { cpus = params.cores ; container = 'nanozoo/nanoplot:1.25.0--4e2882f' }
            withLabel: plasflow { cpus = params.cores ; container = 'quay.io/biocontainers/plasflow:1.1.0--py35_0' }
            withLabel: rmetaplot { cpus = params.cores ; container = 'replikation/r-metasourmash:v0.2' } 
            withLabel: seqtk { cpus = params.cores ; container = 'quay.io/biocontainers/fusioncatcher-seqtk:1.2--h84994c4_0'}
            withLabel: sourmash { cpus = 4 ; container = 'nanozoo/sourmash:2.0.1--6970ddc'  }
            withLabel: ubuntu { cpus = 1 ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' } 
        }}

    UKJ {
        params.cloudProcess = false
        workDir = "/tmp/nextflow-work-$USER"
        process.executor = 'local'
        docker { enabled = true }
        process {
            withLabel: abricate { cpus = 1 ; container = 'nanozoo/abricate:0.9.3--db720c5' }  
            withLabel: bwa { cpus = params.cores ; container = 'quay.io/biocontainers/shovill:1.0.4--0'  }
            withLabel: centrifuge { cpus = params.cores ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: centrifugescale { container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: emboss { cpus = params.cores ; container = 'quay.io/biocontainers/emboss:6.5.7--4' }
            withLabel: filtlong { cpus = 1 ; container = 'nanozoo/filtlong:v0.2.0--afa175e' }
            withLabel: ggplot2 { cpus = 1 ; container = 'michelsteuwer/ggplot2:latest' }
            withLabel: gtdbtk { cpus = params.cores ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' }     
            withLabel: krona { cpus = params.cores ; container = 'nanozoo/krona:2.7.1--658845d' }
            withLabel: metamaps { cpus = params.cores ; container = 'nanozoo/metamaps:latest' }
            withLabel: nanoplot { cpus = params.cores ; container = 'nanozoo/nanoplot:1.25.0--4e2882f' }
            withLabel: plasflow { cpus = params.cores ; container = 'quay.io/biocontainers/plasflow:1.1.0--py35_0' }
            withLabel: rmetaplot { cpus = params.cores ; container = 'replikation/r-metasourmash:v0.2' } 
            withLabel: seqtk { cpus = params.cores ; container = 'quay.io/biocontainers/fusioncatcher-seqtk:1.2--h84994c4_0'}
            withLabel: sourmash { cpus = params.cores ; container = 'nanozoo/sourmash:2.0.1--6970ddc'  }
        }}

    lsf {
        params.cloudProcess = true
        workDir = "/homes/mhoelzer/data/nextflow-work-$USER/"
	process.executor = 'lsf'
        singularity {
            enabled = true
            autoMounts = true
            cacheDir = "/hps/nobackup2/singularity/$USER/"
        }
        process {   
            cache = "lenient"
            
            withLabel: abricate { cpus = 6 ; memory = '14 GB' ; container = 'nanozoo/abricate:0.9.3--db720c5' }  
            withLabel: bwa { cpus = 16 ; memory = '20 GB' ; container = 'quay.io/biocontainers/shovill:1.0.4--0'  }
            withLabel: centrifuge { cpus = 26 ; memory = '160 GB' ; clusterOptions = '-P bigmem' ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: centrifugescale { container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: dev { cpus = 40 ; memory = '300 GB' ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' }
            withLabel: emboss { cpus = 2 ; memory = '6 GB' ; container = 'quay.io/biocontainers/emboss:6.5.7--4' }
            withLabel: filtlong { cpus = 16 ; memory = '20 GB' ; container = 'nanozoo/filtlong:v0.2.0--afa175e' } 
            withLabel: ggplot2 { cpus = 2 ; memory = '6 GB' ; container = 'michelsteuwer/ggplot2:latest' }
            withLabel: gtdbtk { cpus = 34 ; memory = '180 GB' ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' } 
            withLabel: krona { cpus = 2 ; memory = '6 GB' ; container = 'nanozoo/krona:2.7.1--658845d' }
            withLabel: metamaps { cpus = 34 ; memory = '180 GB' ; container = 'nanozoo/metamaps:latest' }
            withLabel: nanoplot { cpus = 8 ; memory = '24 GB' ; container = 'nanozoo/nanoplot:1.25.0--4e2882f' }
            withLabel: plasflow { cpus = 8 ; memory = '16 GB' ; container = 'quay.io/biocontainers/plasflow:1.1.0--py35_0' }
            withLabel: rmetaplot { cpus = 1 ; memory = '4 GB' ; container = 'replikation/r-metasourmash:v0.2' } 
            withLabel: seqtk { cpus = 8 ; memory = '16 GB' ; container = 'quay.io/biocontainers/fusioncatcher-seqtk:1.2--h84994c4_0'}
            withLabel: sourmash { cpus = 8 ; memory = '24 GB' ; container = 'nanozoo/sourmash:2.0.1--6970ddc' }
            withLabel: ubuntu { cpus = 1 ; memory = '2 GB' ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' } 
        }}

    gcloud {
        params.cloudProcess = true
        workDir = "/tmp/nextflow-work-$USER"
        bucketDir = 'gs://nextflow-tmp-workdir/workdir-analysis'
        docker { enabled = true }
        google {  project = 'nextflow-auto' ; zone = 'europe-west1-b' }
        //cloud { preemptible = true }
        process {   
            executor = 'google-pipelines'
            
            withLabel: abricate { cpus = 6 ; memory = '14 GB' ; container = 'nanozoo/abricate:0.9.3--db720c5' }  
            withLabel: bwa { cpus = 16 ; memory = '20 GB' ; container = 'quay.io/biocontainers/shovill:1.0.4--0'  }
            withLabel: centrifuge { cpus = 26 ; memory = '160 GB' ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: centrifugescale { container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' } 
            withLabel: dev { cpus = 40 ; memory = '300 GB' ; container = 'nanozoo/centrifuge:v1.0.4-beta--fab181c' }
            withLabel: emboss { cpus = 2 ; memory = '6 GB' ; container = 'quay.io/biocontainers/emboss:6.5.7--4' }
            withLabel: filtlong { cpus = 16 ; memory = '20 GB' ; container = 'nanozoo/filtlong:v0.2.0--afa175e' } 
            withLabel: ggplot2 { cpus = 2 ; memory = '6 GB' ; container = 'michelsteuwer/ggplot2:latest' }
            withLabel: gtdbtk { cpus = 34 ; memory = '180 GB' ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' } 
            withLabel: krona { cpus = 2 ; memory = '6 GB' ; container = 'nanozoo/krona:2.7.1--658845d' }
            withLabel: metamaps { cpus = 34 ; memory = '180 GB' ; container = 'nanozoo/metamaps:latest' }
            withLabel: nanoplot { cpus = 8 ; memory = '24 GB' ; container = 'nanozoo/nanoplot:1.25.0--4e2882f' }
            withLabel: plasflow { cpus = 8 ; memory = '16 GB' ; container = 'quay.io/biocontainers/plasflow:1.1.0--py35_0' }
            withLabel: rmetaplot { cpus = 1 ; memory = '4 GB' ; container = 'replikation/r-metasourmash:v0.2' } 
            withLabel: seqtk { cpus = 8 ; memory = '16 GB' ; container = 'quay.io/biocontainers/fusioncatcher-seqtk:1.2--h84994c4_0'}
            withLabel: sourmash { cpus = 8 ; memory = '24 GB' ; container = 'nanozoo/sourmash:2.0.1--6970ddc' }
            withLabel: ubuntu { cpus = 1 ; memory = '2 GB' ; container = 'nanozoo/gtdbtk:0.3.2--676fab7' } 
        }}} 